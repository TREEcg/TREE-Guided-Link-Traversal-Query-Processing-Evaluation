{"version":3,"file":"ViewDescription.js","sourceRoot":"","sources":["../../../src/ldes/viewDescription/ViewDescription.ts"],"names":[],"mappings":"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","sourcesContent":["import {DataFactory, Store} from \"n3\";\nimport namedNode = DataFactory.namedNode;\nimport {LDES, TREE} from \"@treecg/types\";\nimport {RDF} from \"@solid/community-server\";\nimport {DCAT} from \"../../util/Vocabulary\";\nimport literal = DataFactory.literal;\nimport type * as Rdf from '@rdfjs/types';\n\nexport interface N3Support {\n    getStore: () => Store;\n}\n\n/**\n * An interface that holds the properties for a `tree:ViewDescription`\n * (https://github.com/Informatievlaanderen/OSLOthema-ldes/issues/4).\n */\nexport interface IViewDescription extends N3Support {\n    id: string\n    /**\n     * Property that holds the client that is responsible to maintain the structure of this view.\n     * `ldes:managedBy`\n     */\n    managedBy: IIngestorClient\n    /**\n     * Property that holds the URI of the LDES.\n     * `dcat:serversDataset` (see DCAT 3 ยง6.9.3)\n     */\n    servesDataset: string\n    /**\n     * Property that holds the URI of an LDES view (the root `tree:node`).\n     * `dcat:serversDataset` (see DCAT 3 ยง6.9.1)\n     */\n    endpointURL: string\n\n    quads: () => Rdf.Quad[];\n}\n\n/**\n * An interface that holds the properties for an IngestorClient.\n * Such client is responsible for creating this view in an LDES.\n */\nexport interface IIngestorClient extends N3Support {\n    id: string\n    /**\n     * Property that holds the bucketization strategy of the view.\n     */\n    bucketizeStrategy: IBucketizeStrategy\n    /**\n     * Type of the IngestorClient client\n     */\n    type: string\n}\n\n/**\n * An interface that holds the properties for a `ldes:BucketizeStrategy` (\n * https://github.com/ajuvercr/sds-processors/blob/master/bucketizeStrategy.ttl and\n * https://github.com/Informatievlaanderen/OSLOthema-ldes/issues/4).\n */\nexport interface IBucketizeStrategy extends N3Support {\n    id: string\n    bucketType: string\n    path: string // should be SHACLPath\n    pageSize?: number\n}\n\n\nexport class ViewDescription implements IViewDescription {\n    private _id: string\n    private _managedBy: IIngestorClient\n    private _servesDataset: string\n    private _endpointURL: string\n\n    constructor(id: string, managedBy: IIngestorClient, eventStreamIdentifier: string, rootNodeIdentifier: string) {\n        this._id = id;\n        this._managedBy = managedBy;\n        this._servesDataset = eventStreamIdentifier;\n        this._endpointURL = rootNodeIdentifier;\n    }\n\n    get id(): string {\n        return this._id;\n    }\n\n    get managedBy(): IIngestorClient {\n        return this._managedBy;\n    }\n\n\n    get servesDataset(): string {\n        return this._servesDataset;\n    }\n\n    get endpointURL(): string {\n        return this._endpointURL;\n    }\n\n    getStore(): Store {\n        const store = new Store()\n        store.addQuad(namedNode(this.id), RDF.terms.type, TREE.terms.custom(\"ViewDescription\"))\n        store.addQuad(namedNode(this.id), DCAT.terms.servesDataset, namedNode(this.servesDataset))\n        store.addQuad(namedNode(this.id), DCAT.terms.endpointURL, namedNode(this.endpointURL))\n\n        store.addQuad(namedNode(this.id), LDES.terms.custom(\"managedBy\"), namedNode(this.managedBy.id))\n        store.addQuads(this.managedBy.getStore().getQuads(null, null, null, null))\n        return store\n    }\n\n    quads(): Rdf.Quad[] {\n        return this.getStore().getQuads(null,null,null,null);\n    }\n}\n\nexport class IngestorClient implements IIngestorClient {\n    private _bucketizeStrategy: IBucketizeStrategy;\n    private _id: string;\n\n    private _type: string;\n\n    constructor(id: string, bucketizeStrategy: IBucketizeStrategy, type: string) {\n        this._bucketizeStrategy = bucketizeStrategy;\n        this._id = id;\n        this._type = type;\n    }\n\n    get bucketizeStrategy(): IBucketizeStrategy {\n        return this._bucketizeStrategy;\n    }\n\n    get id(): string {\n        return this._id;\n    }\n\n\n    get type(): string {\n        return this._type;\n    }\n\n    getStore(): Store {\n        const store = new Store()\n        store.addQuad(namedNode(this.id), RDF.terms.type, namedNode(this.type))\n        store.addQuad(namedNode(this.id), LDES.terms.custom(\"bucketizeStrategy\"), namedNode(this.bucketizeStrategy.id))\n\n        store.addQuads(this.bucketizeStrategy.getStore().getQuads(null, null, null, null))\n        return store;\n    }\n}\n\nexport class BucketizeStrategy implements IBucketizeStrategy {\n    private _bucketType: string;\n    private _id: string;\n    private _pageSize: number | undefined;\n    private _path: string;\n\n    constructor(id: string, bucketType: string, path: string, pageSize?: number) {\n        this._bucketType = bucketType;\n        this._id = id;\n        this._pageSize = pageSize;\n        this._path = path;\n    }\n\n    get bucketType(): string {\n        return this._bucketType;\n    }\n\n    get id(): string {\n        return this._id;\n    }\n\n    get pageSize(): number | undefined {\n        return this._pageSize;\n    }\n\n    get path(): string {\n        return this._path;\n    }\n\n    getStore(): Store {\n        const store = new Store()\n        store.addQuad(namedNode(this.id), RDF.terms.type, LDES.terms.BucketizeStrategy)\n        store.addQuad(namedNode(this.id), LDES.terms.bucketType, namedNode(this.bucketType))\n        store.addQuad(namedNode(this.id), TREE.terms.path, namedNode(this.path))\n        if (this.pageSize) {\n            store.addQuad(namedNode(this.id), LDES.terms.custom(\"pageSize\"), literal(this.pageSize))\n        }\n        return store;\n    }\n}\n"]}